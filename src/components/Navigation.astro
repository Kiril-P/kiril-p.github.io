---
import MagneticButton from './MagneticButton';
import ThemeToggle from './ThemeToggle';
---

<nav class="nav-header fixed top-0 left-0 right-0 z-50 backdrop-blur-md bg-premium-black/80 border-b border-white/5 transition-all duration-300">
  <div class="max-w-7xl mx-auto px-6 py-4">
    <!-- Desktop Layout with Grid for proper centering -->
    <div class="hidden md:grid grid-cols-3 items-center">
      <!-- Logo/Name (Left) with expand on hover -->
      <a href="#hero" class="nav-logo group/logo relative text-xl font-bold tracking-tight justify-self-start">
        <span class="logo-short inline-block transition-opacity duration-300 group-hover/logo:opacity-0">
          KP <span class="text-white/30">//</span>
        </span>
        <span class="logo-full absolute left-0 top-0 inline-block opacity-0 transition-opacity duration-300 group-hover/logo:opacity-100 text-blue-accent whitespace-nowrap">
          coded by Kiril <span class="text-white/30">//</span>
        </span>
      </a>

      <!-- Desktop Navigation (Center) -->
      <div class="flex items-center gap-8 justify-self-center">
        <a href="#projects" class="nav-link text-sm text-white/70 hover:text-white transition-colors duration-300">
          Projects
        </a>
        <a href="#about" class="nav-link text-sm text-white/70 hover:text-white transition-colors duration-300">
          About
        </a>
        <a href="#tech-stack" class="nav-link text-sm text-white/70 hover:text-white transition-colors duration-300">
          Tech Stack
        </a>
        <a href="#contact" class="nav-link text-sm text-white/70 hover:text-white transition-colors duration-300">
          Contact
        </a>
      </div>

      <!-- Right Side: Theme Toggle + CTA Button -->
      <div class="flex items-center gap-3 justify-self-end">
        <MagneticButton 
          client:load
          href="#get-in-touch" 
          className="px-5 py-2.5 rounded-full bg-blue-accent/10 border border-blue-accent/20 text-sm font-medium text-blue-accent hover:bg-blue-accent/20 hover:border-blue-accent/40 transition-all duration-300"
          strength={0.4}
        >
          <span>Get in Touch</span>
          <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="7" y1="17" x2="17" y2="7"></line>
            <polyline points="7 7 17 7 17 17"></polyline>
          </svg>
        </MagneticButton>
        <ThemeToggle client:load />
      </div>
    </div>

    <!-- Mobile Layout -->
    <div class="md:hidden flex items-center justify-between">
      <!-- Logo/Name with expand on hover (mobile) -->
      <a href="#hero" class="nav-logo group/logo relative text-xl font-bold tracking-tight">
        <span class="logo-short inline-block transition-opacity duration-300 group-hover/logo:opacity-0">
          KP <span class="text-white/30">//</span>
        </span>
        <span class="logo-full absolute left-0 top-0 inline-block opacity-0 transition-opacity duration-300 group-hover/logo:opacity-100 text-blue-accent whitespace-nowrap">
          coded by Kiril <span class="text-white/30">//</span>
        </span>
      </a>

      <!-- Mobile Right Side: Theme Toggle + Menu Button -->
      <div class="flex items-center gap-3">
        <!-- Mobile Menu Button -->
        <button 
          id="mobile-menu-btn"
          class="flex items-center justify-center w-10 h-10 rounded-lg bg-white/5 border border-white/10 hover:bg-white/10 transition-colors duration-300"
          aria-label="Toggle menu"
        >
          <svg class="menu-icon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="3" y1="12" x2="21" y2="12"></line>
            <line x1="3" y1="6" x2="21" y2="6"></line>
            <line x1="3" y1="18" x2="21" y2="18"></line>
          </svg>
          <svg class="close-icon hidden" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
        <ThemeToggle client:load />
      </div>
  </div>

  <!-- Mobile Menu -->
  <div id="mobile-menu" class="mobile-menu md:hidden overflow-hidden max-h-0 transition-all duration-300 ease-in-out">
    <div class="px-6 py-4 border-t border-white/5 bg-premium-gray/50 backdrop-blur-lg">
      <div class="flex flex-col gap-4">
        <a href="#projects" class="mobile-link text-white/70 hover:text-white transition-colors duration-300 py-2">
          Projects
        </a>
        <a href="#about" class="mobile-link text-white/70 hover:text-white transition-colors duration-300 py-2">
          About
        </a>
        <a href="#tech-stack" class="mobile-link text-white/70 hover:text-white transition-colors duration-300 py-2">
          Tech Stack
        </a>
        <a href="#contact" class="mobile-link text-white/70 hover:text-white transition-colors duration-300 py-2">
          Contact
        </a>
        <a 
          href="#get-in-touch" 
          class="mobile-link flex items-center justify-center gap-2 px-5 py-3 rounded-full bg-blue-accent/10 border border-blue-accent/20 text-sm font-medium text-blue-accent hover:bg-blue-accent/20 transition-all duration-300 mt-2"
        >
          <span>Get in Touch</span>
        </a>
        <!-- Note: Magnetic effect disabled on mobile for better touch UX -->
      </div>
    </div>
  </div>
</nav>

<style>
  .nav-header {
    animation: slideDown 0.5s ease-out;
  }

  @keyframes slideDown {
    from {
      transform: translateY(-100%);
      opacity: 0;
    }
    to {
      transform: translateY(0);
      opacity: 1;
    }
  }

  .nav-link::after {
    content: '';
    display: block;
    width: 0;
    height: 1px;
    background: rgb(59, 130, 246);
    transition: width 0.3s ease;
    margin-top: 2px;
  }

  .nav-link:hover::after {
    width: 100%;
  }

  .mobile-menu.open {
    max-height: 400px;
  }
</style>

<script>
  // Mobile menu toggle
  const menuBtn = document.getElementById('mobile-menu-btn');
  const mobileMenu = document.getElementById('mobile-menu');
  const menuIcon = menuBtn?.querySelector('.menu-icon');
  const closeIcon = menuBtn?.querySelector('.close-icon');
  
  menuBtn?.addEventListener('click', () => {
    mobileMenu?.classList.toggle('open');
    menuIcon?.classList.toggle('hidden');
    closeIcon?.classList.toggle('hidden');
  });

  // Close mobile menu when clicking on a link
  document.querySelectorAll('.mobile-link').forEach(link => {
    link.addEventListener('click', () => {
      mobileMenu?.classList.remove('open');
      menuIcon?.classList.remove('hidden');
      closeIcon?.classList.add('hidden');
    });
  });

  // Smooth scroll for all nav links (handled by Lenis in MainLayout)
  // We just need to prevent default and let Lenis handle the scroll
  document.querySelectorAll('a[href^="#"]').forEach(anchor => {
    anchor.addEventListener('click', function (e) {
      const href = this.getAttribute('href');
      if (href && href.startsWith('#')) {
        e.preventDefault();
        const target = document.querySelector(href);
        if (target) {
          const navHeight = document.querySelector('.nav-header')?.offsetHeight || 0;
          const targetPosition = target.getBoundingClientRect().top + window.pageYOffset - navHeight - 20;
          
          // Use window.scrollTo which Lenis will intercept
          window.scrollTo({
            top: targetPosition,
            behavior: 'smooth'
          });
        }
      }
    });
  });

  // Add scroll effect to nav
  let lastScroll = 0;
  window.addEventListener('scroll', () => {
    const nav = document.querySelector('.nav-header');
    const currentScroll = window.pageYOffset;
    
    if (currentScroll > 100) {
      nav?.classList.add('scrolled');
    } else {
      nav?.classList.remove('scrolled');
    }
    
    lastScroll = currentScroll;
  });
</script>
