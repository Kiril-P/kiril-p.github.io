---
import MainLayout from '../../layouts/MainLayout.astro';
import { featuredProjects } from '../../lib/projects-config';
import { projectContent } from '../../lib/project-content';
import { ArrowLeft, Github, Globe, Lock, Rocket, Zap, Code2, Layers, AlertTriangle, Wrench } from 'lucide-react';
import Navigation from '../../components/Navigation.astro';
import Footer from '../../components/Footer.astro';
import BackgroundSwirls from '../../components/BackgroundSwirls.astro';

export async function getStaticPaths() {
  return featuredProjects.map(project => ({
    params: { slug: project.slug },
    props: { project },
  }));
}

const { project } = Astro.props;
const content = projectContent[project.slug];

// Status Badge Config
const statusConfig = {
  'open-source': {
    label: 'Open Source',
    color: 'text-green-400',
    bg: 'bg-green-500/10',
    border: 'border-green-500/20',
    icon: Github
  },
  'closed-source': {
    label: 'Closed Source',
    color: 'text-red-400',
    bg: 'bg-red-500/10',
    border: 'border-red-500/20',
    icon: Lock
  },
  'proprietary': {
    label: 'Proprietary',
    color: 'text-orange-400',
    bg: 'bg-orange-500/10',
    border: 'border-orange-500/20',
    icon: Lock
  }
};

const status = statusConfig[project.sourceType] || statusConfig['open-source'];
const StatusIcon = status.icon;
---

<MainLayout title={`${project.name} | Kiril Petrovski`} description={project.description}>
  <BackgroundSwirls />
  <Navigation />

  <main class="min-h-screen pt-32 pb-20 relative z-10">
    <div class="max-w-6xl mx-auto px-6">
      
      <!-- Back Navigation -->
      <a href="/#projects" class="inline-flex items-center gap-2 text-white/50 hover:text-blue-accent transition-colors mb-8 group">
        <ArrowLeft className="w-4 h-4 transition-transform group-hover:-translate-x-1" />
        <span>Back to Exhibition</span>
      </a>

      <!-- Header Section -->
      <header class="mb-16">
        <div class="flex flex-wrap items-center gap-4 mb-6">
          <div class={`inline-flex items-center gap-2 px-3 py-1.5 rounded-full border ${status.bg} ${status.border} ${status.color}`}>
            <StatusIcon className="w-4 h-4" />
            <span class="text-xs font-medium uppercase tracking-wider">{status.label}</span>
          </div>
          <span class="text-white/30">|</span>
          <span class="text-blue-accent font-mono">{project.language}</span>
          {project.category && (
            <>
              <span class="text-white/30">|</span>
              <span class="text-white/50 capitalize">{project.category}</span>
            </>
          )}
        </div>

        <h1 class="text-5xl md:text-7xl font-bold mb-6 tracking-tight">{project.name}</h1>
        <p class="text-xl text-white/60 max-w-3xl leading-relaxed">{project.description}</p>

        <div class="flex flex-wrap gap-4 mt-8">
          {project.github_url && project.sourceType === 'open-source' && (
            <a href={project.github_url} target="_blank" rel="noopener" class="px-6 py-3 rounded-full bg-blue-accent hover:bg-blue-accent-dark text-white font-medium transition-all flex items-center gap-2 hover:scale-105 hover:shadow-lg hover:shadow-blue-accent/20">
              <Github className="w-5 h-5" />
              <span>View Code</span>
            </a>
          )}
          {project.demo_url && (
            <a href={project.demo_url} target="_blank" rel="noopener" class="px-6 py-3 rounded-full bg-purple-600 hover:bg-purple-700 text-white font-medium transition-all flex items-center gap-2 hover:scale-105 hover:shadow-lg hover:shadow-purple-600/20">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <line x1="6" y1="11" x2="10" y2="11"></line>
                <line x1="8" y1="9" x2="8" y2="13"></line>
                <line x1="15" y1="12" x2="15.01" y2="12"></line>
                <line x1="18" y1="10" x2="18.01" y2="10"></line>
                <path d="M17.32 5H6.68a4 4 0 0 0-3.978 3.59c-.006.052-.01.101-.017.152C2.604 9.416 2 14.456 2 16a3 3 0 0 0 3 3c1 0 1.5-.5 2-1l1.414-1.414A2 2 0 0 1 9.828 16h4.344a2 2 0 0 1 1.414.586L17 18c.5.5 1 1 2 1a3 3 0 0 0 3-3c0-1.545-.604-6.584-.685-7.258-.007-.05-.011-.1-.017-.151A4 4 0 0 0 17.32 5z"></path>
              </svg>
              <span>View Demo</span>
            </a>
          )}
          {project.website_url && (
            <a href={project.website_url} target="_blank" rel="noopener" class="px-6 py-3 rounded-full bg-gradient-to-r from-emerald-600 to-teal-600 hover:from-emerald-700 hover:to-teal-700 text-white font-medium transition-all flex items-center gap-2 hover:scale-105 hover:shadow-lg hover:shadow-emerald-600/20">
              <Globe className="w-5 h-5" />
              <span>Visit Website</span>
            </a>
          )}
          {project.html_url && project.sourceType !== 'open-source' && !project.github_url && !project.website_url && (
            <a href={project.html_url} target="_blank" rel="noopener" class="px-6 py-3 rounded-full bg-white/10 hover:bg-white/20 text-white font-medium transition-all flex items-center gap-2">
              <Globe className="w-5 h-5" />
              <span>Visit Deployment</span>
            </a>
          )}
        </div>
      </header>

      <!-- Media Showcase -->
      <section class="mb-20 rounded-3xl overflow-hidden border border-white/5 bg-premium-gray/50 relative aspect-video group shadow-2xl">
        {project.video_url ? (
            <div class="absolute inset-0">
                <iframe 
                    src={`https://www.youtube.com/embed/${project.video_url.split('/').pop()}?autoplay=1&mute=1&loop=1&playlist=${project.video_url.split('/').pop()}&controls=0&showinfo=0&rel=0`}
                    class="w-full h-full object-cover opacity-80 group-hover:opacity-100 transition-opacity duration-700 pointer-events-none"
                    allow="autoplay; encrypted-media" 
                    allowfullscreen
                    title={`${project.name} Gameplay`}
                ></iframe>
                 <div class="absolute inset-0 bg-gradient-to-t from-premium-black/30 via-transparent to-transparent pointer-events-none"></div>
            </div>
        ) : (
            <div class="absolute inset-0">
                 <img 
                    src={project.thumbnail} 
                    alt={project.name} 
                    class="w-full h-full object-cover opacity-90 group-hover:scale-105 transition-transform duration-700" 
                 />
                 <div class="absolute inset-0 bg-gradient-to-t from-premium-black/30 via-transparent to-transparent"></div>
            </div>
        )}
      </section>

      {content && (
        <>
          <!-- Long Description -->
          <section class="mb-20">
            <div class="prose prose-invert prose-lg max-w-none">
              {content.longDescription.split('\n\n').map((paragraph) => (
                <p class="text-white/70 text-lg leading-relaxed mb-6">{paragraph}</p>
              ))}
            </div>
          </section>

          <!-- Tech Stack Pills -->
          <section class="mb-20">
            <div class="flex items-center gap-3 mb-6">
              <div class="p-2 rounded-lg bg-blue-accent/10 border border-blue-accent/20">
                <Wrench className="w-5 h-5 text-blue-accent" />
              </div>
              <h2 class="text-2xl font-bold">Tech Stack</h2>
            </div>
            <div class="flex flex-wrap gap-3">
              {content.techStack.map((tech) => (
                <span class="px-4 py-2 rounded-full bg-white/5 border border-white/10 text-white/80 text-sm font-medium hover:border-blue-accent/40 hover:bg-blue-accent/5 transition-colors">
                  {tech}
                </span>
              ))}
            </div>
          </section>

          <!-- Two Column Grid: Features + Technical Highlights -->
          <section class="grid md:grid-cols-2 gap-8 mb-20">
            <!-- Features Card -->
            <div class="p-8 rounded-2xl bg-premium-gray/50 border border-white/5 hover:border-green-500/20 transition-colors">
              <div class="flex items-center gap-3 mb-6">
                <div class="p-2 rounded-lg bg-green-500/10 border border-green-500/20">
                  <Rocket className="w-5 h-5 text-green-400" />
                </div>
                <h3 class="text-xl font-bold">Key Features</h3>
              </div>
              <ul class="space-y-3">
                {content.features.map((feature) => (
                  <li class="flex items-start gap-3 text-white/70">
                    <span class="w-1.5 h-1.5 rounded-full bg-green-400 mt-2.5 flex-shrink-0"></span>
                    <span>{feature}</span>
                  </li>
                ))}
              </ul>
            </div>

            <!-- Technical Highlights Card -->
            <div class="p-8 rounded-2xl bg-premium-gray/50 border border-white/5 hover:border-purple-500/20 transition-colors">
              <div class="flex items-center gap-3 mb-6">
                <div class="p-2 rounded-lg bg-purple-500/10 border border-purple-500/20">
                  <Zap className="w-5 h-5 text-purple-400" />
                </div>
                <h3 class="text-xl font-bold">Technical Highlights</h3>
              </div>
              <ul class="space-y-3">
                {content.technicalHighlights.map((highlight) => (
                  <li class="flex items-start gap-3 text-white/70">
                    <span class="w-1.5 h-1.5 rounded-full bg-purple-400 mt-2.5 flex-shrink-0"></span>
                    <span>{highlight}</span>
                  </li>
                ))}
              </ul>
            </div>
          </section>

          <!-- Architecture Section -->
          {content.architecture && content.architecture.length > 0 && (
            <section class="mb-20">
              <div class="flex items-center gap-3 mb-8">
                <div class="p-2 rounded-lg bg-cyan-500/10 border border-cyan-500/20">
                  <Layers className="w-5 h-5 text-cyan-400" />
                </div>
                <h2 class="text-2xl font-bold">Architecture</h2>
              </div>
              <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
                {content.architecture.map((section) => (
                  <div class="p-6 rounded-2xl bg-premium-gray/30 border border-white/5 hover:border-cyan-500/20 transition-colors">
                    <h4 class="text-lg font-semibold text-cyan-400 mb-4">{section.title}</h4>
                    <ul class="space-y-2">
                      {section.items.map((item) => (
                        <li class="flex items-start gap-2 text-white/60 text-sm">
                          <Code2 className="w-3 h-3 text-cyan-400/60 mt-1 flex-shrink-0" />
                          <span>{item}</span>
                        </li>
                      ))}
                    </ul>
                  </div>
                ))}
              </div>
            </section>
          )}

          <!-- Challenges Section -->
          {content.challenges && content.challenges.length > 0 && (
            <section class="mb-20">
              <div class="flex items-center gap-3 mb-8">
                <div class="p-2 rounded-lg bg-amber-500/10 border border-amber-500/20">
                  <AlertTriangle className="w-5 h-5 text-amber-400" />
                </div>
                <h2 class="text-2xl font-bold">Challenges & Solutions</h2>
              </div>
              <div class="grid md:grid-cols-2 gap-4">
                {content.challenges.map((challenge, index) => (
                  <div class="p-5 rounded-xl bg-amber-500/5 border border-amber-500/10 hover:border-amber-500/30 transition-colors">
                    <div class="flex items-start gap-3">
                      <span class="flex-shrink-0 w-6 h-6 rounded-full bg-amber-500/20 text-amber-400 text-xs font-bold flex items-center justify-center">
                        {index + 1}
                      </span>
                      <p class="text-white/70">{challenge}</p>
                    </div>
                  </div>
                ))}
              </div>
            </section>
          )}
        </>
      )}

      <!-- Gallery Grid -->
      {project.gallery_images && project.gallery_images.length > 0 && (
        <section class="mb-20">
            <h3 class="text-2xl font-bold mb-8">Gallery</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                {project.gallery_images.map((img, index) => (
                    <div class="rounded-2xl overflow-hidden border border-white/5 hover:border-blue-accent/30 transition-colors bg-premium-gray/30 p-4">
                        <img 
                            src={img} 
                            alt={`${project.name} Screenshot ${index + 1}`} 
                            class="w-full h-auto object-contain rounded-lg" 
                        />
                    </div>
                ))}
            </div>
        </section>
      )}

    </div>
  </main>

  <Footer />
</MainLayout>

<style>
  /* Smooth section transitions */
  section {
    animation: fadeIn 0.6s ease-out;
  }

  @keyframes fadeIn {
    from {
      opacity: 0;
      transform: translateY(20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  /* Enhanced list styling */
  ul li {
    transition: transform 0.2s ease;
  }

  ul li:hover {
    transform: translateX(4px);
  }
</style>
